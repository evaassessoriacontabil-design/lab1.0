<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>LaboratÃ³rio ContÃ¡bil â€” v6.12 Premium</title>
<style>
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:#0a0a0a;color:#fff;font-family:Arial, system-ui, -apple-system}
  .screen{display:none;position:relative;width:100vw;height:100vh;overflow:hidden}
  @supports (height:100svh){.screen{height:100svh}}
  .show{display:block}
  .bg{position:absolute;inset:0;background-position:center;background-repeat:no-repeat;background-size:100% 100%;pointer-events:none}
  .wrap{position:relative;z-index:2;display:flex;align-items:center;justify-content:flex-end;height:100%;padding:5%}
  .btn{appearance:none;-webkit-appearance:none;background:#ff2d2d;color:#fff;border:0;border-radius:12px;padding:16px 28px;font-weight:700;font-size:28px;min-width:240px;cursor:pointer;text-decoration:none;display:inline-block;text-align:center}
  .quiz-card{background:#fff;color:#000;border-radius:14px;padding:22px;max-width:640px;box-shadow:0 8px 22px rgba(0,0,0,.35)}
  /* QUIZ Ã  direita */
  #quiz .wrap{justify-content:flex-end;align-items:center;padding-right:8%}
  /* coluna direita: tÃ­tulo fora do card + card abaixo */
  .quiz-col{display:flex;flex-direction:column;align-items:flex-end;gap:12px;max-width:720px;width:100%}
  .quiz-head{color:#fff;font-weight:900;font-size:clamp(22px,3.4vw,38px);letter-spacing:.2px;text-align:right;line-height:1.15}
  .quiz-head .accent{display:inline-block;background:#ff2d2d;padding:4px 10px;border-radius:999px;font-size:.65em;margin-left:10px;vertical-align:middle}
  .quiz-top{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:12px}
  .counter{background:#111;color:#fff;padding:6px 10px;border-radius:999px;font-weight:700;font-size:16px;min-width:66px;text-align:center}
  #qtext{font-size:clamp(22px,3vw,34px);font-weight:800;margin:12px 0 16px}
  .opt{display:block;width:100%;margin:8px 0;padding:14px;background:#eee;border:0;border-radius:10px;text-align:left;font-size:clamp(16px,2vw,20px);cursor:pointer}
  /* Resultado centralizado */
  #result .wrap{flex-direction:column;justify-content:center;align-items:center;padding:5%}
  .actions{text-align:left;margin:16px 0;padding-left:18px}
  .actions li{margin:8px 0}
  .btn-row{display:flex;gap:20px;margin-top:20px;justify-content:center;flex-wrap:wrap}
  .btn-secondary{background:#2a2a2a;color:#fff;border:0;border-radius:12px;padding:16px 28px;font-weight:700;font-size:22px;min-width:220px;cursor:pointer}
  .btn-cta{background:#ff2d2d;color:#fff;border:0;border-radius:12px;padding:16px 28px;font-weight:700;font-size:22px;min-width:220px;cursor:pointer}
  /* GÃªnero: espaÃ§o entre botÃµes */
  #gender .wrap{flex-direction:column;align-items:flex-end;justify-content:center;gap:18px}
  @media (max-width:480px){
    .btn{font-size:20px;min-width:200px}
    .btn-cta,.btn-secondary{font-size:18px;min-width:180px}
    .quiz-card{max-width:92vw;padding:18px}
    #quiz .wrap{padding-right:4%}
    .quiz-col{max-width:92vw}
  }
</style>
</head>
<body>

<!-- CAPA -->
<section id="cover" class="screen show">
  <div class="bg" style="background-image:url('images/capa.png')"></div>
  <div class="wrap" style="align-items:flex-end;justify-content:flex-end">
    <button class="btn" onclick="go('intro')">ðŸŽ® VAMOS JOGAR</button>
  </div>
</section>

<!-- INTRODUÃ‡ÃƒO -->
<section id="intro" class="screen">
  <div class="bg" style="background-image:url('images/intro.png')"></div>
  <div class="wrap" style="align-items:flex-end;justify-content:flex-end">
    <!-- Mercado Pago em nova aba -->
<a class="btn" id="ativarBtn" target="_blank" rel="noopener" href="https://mpago.la/13t2mZ7">ATIVAR JOGO â€“ R$29,90</a>
  </div>
</section>

<!-- GÃŠNERO -->
<section id="gender" class="screen">
  <div class="bg" style="background-image:url('images/genero.png')"></div>
  <div class="wrap">
    <div class="quiz-col">
      <button class="btn" onclick="playClick(); start('fem')">Jogar como Feminino</button>
      <button class="btn" onclick="playClick(); start('masc')">Jogar como Masculino</button>
    </div>
  </div>
</section>

<!-- QUIZ -->
<section id="quiz" class="screen">
  <div id="bg-quiz" class="bg"></div>
  <div class="wrap">
    <div class="quiz-col">
      <div id="quiz-head" class="quiz-head">
        Segure firme: seu diagnÃ³stico empreendedor comeÃ§a agora!
        <span class="accent">InÃ­cio</span>
      </div>
      <div class="quiz-card">
        <div class="quiz-top">
          <div style="height:1px"></div>
          <div id="q-counter" class="counter">1/15</div>
        </div>
        <div id="qtext"></div>
        <div id="opts"></div>
      </div>
    </div>
  </div>
</section>

<!-- RESULTADO -->
<section id="result" class="screen">
  <div class="bg" id="bg-result"></div>
  <div class="wrap">
    <div class="quiz-card" style="margin-bottom:22px;">
      <h2 id="r-title"></h2>
      <p id="r-desc"></p>
      <ul id="r-actions" class="actions"></ul>
    </div>
    <div class="btn-row">
      <button id="r-course" class="btn-cta"></button>
      <button class="btn-secondary" onclick="playClick(); go('cover')">ðŸ”„ RecomeÃ§ar o jogo</button>
    </div>
  </div>
</section>

<!-- ÃUDIO -->
<audio id="snd-click" src="sounds/click.mp3" preload="auto" playsinline></audio>
<audio id="snd-win" src="sounds/win.mp3" preload="auto" playsinline></audio>

<script>
/* ===== Token gating ===== */
let isAuthorized = false;
async function validarAcessoSeHouverToken() {
  const token = new URLSearchParams(location.search).get("token");
  const localDev = location.protocol === 'file:' || location.hostname === 'localhost';
  if (localDev) { isAuthorized = true; return; }
  if (!token) { isAuthorized = false; return; }
  try {
    const r = await fetch(`/.netlify/functions/validate-token?token=${encodeURIComponent(token)}`);
    const d = await r.json();
    isAuthorized = !!(d && d.valido);
  } catch { isAuthorized = false; }
}
function gateOr(fn){ return (...a)=> isAuthorized ? fn(...a) : (alert("Acesso restrito. Ative o jogo na IntroduÃ§Ã£o e volte com o link de acesso."), go('intro')); }

/* ===== Ãudio ===== */
const clickSound=document.getElementById('snd-click');
const winSound=document.getElementById('snd-win');
function playClick(){ try{ clickSound.currentTime=0; clickSound.play(); }catch(e){} }
function playWin(){ try{ winSound.currentTime=0; winSound.play(); }catch(e){} }
let audioUnlocked=false;
function unlockAudio(){
  if(audioUnlocked) return;
  [clickSound,winSound].forEach(a=>{ try{ a.muted=true; a.play().then(()=>{a.pause();a.currentTime=0;a.muted=false;}).catch(()=>{});}catch(e){} });
  audioUnlocked=true;
}
document.addEventListener('touchstart',unlockAudio,{passive:true,once:true});
document.addEventListener('pointerdown',unlockAudio,{passive:true,once:true});

/* ===== Perguntas com pesos â€œsalteadosâ€ ===== */
const QUESTIONS = [
  { q:"VocÃª jÃ¡ possui um plano de negÃ³cios estruturado?",
    a:["Rascunho em andamento, usamos como referÃªncia quando necessÃ¡rio","Sim, completo, revisado e usado nas decisÃµes","Ainda nÃ£o; organizo a ideia em anotaÃ§Ãµes soltas","VersÃ£o enxuta com metas e orÃ§amento bÃ¡sico, atualizada Ã s vezes"],
    w:[2,4,1,3]
  },
  { q:"Sua empresa tem metas claras e mensurÃ¡veis para os prÃ³ximos meses?",
    a:["NÃ£o formalizamos metas; trabalhamos no que aparece","Acompanhamos OKRs/SMART com rituais de revisÃ£o","Metas bÃ¡sicas mensais (faturamento/clientes), revisÃ£o ocasional","Metas SMART por Ã¡rea, revisadas com indicadores semanais"],
    w:[1,3,2,4]
  },
  { q:"VocÃª separa as finanÃ§as pessoais das empresariais?",
    a:["Separo e tenho DRE/orÃ§amento; concilio tudo todo mÃªs","Ainda misturo; estou organizando aos poucos","Separo, mas Ã s vezes me atrapalho; uso planilha simples","SeparaÃ§Ã£o total com controles e automaÃ§Ãµes financeiras"],
    w:[3,1,2,4]
  },
  { q:"Costuma tomar decisÃµes mais na intuiÃ§Ã£o ou em dados?",
    a:["IntuiÃ§Ã£o com validaÃ§Ãµes pontuais (pesquisas rÃ¡pidas, testes)","Maior parte na intuiÃ§Ã£o; raramente registro dados","DecisÃµes orientadas por painÃ©is/KPIs e experimentos","Combino dados bÃ¡sicos (planilhas/CRM) com a experiÃªncia prÃ¡tica"],
    w:[2,1,4,3]
  },
  { q:"JÃ¡ buscou consultoria ou mentoria para apoiar sua gestÃ£o?",
    a:["Mentoria recorrente e programas de aceleraÃ§Ã£o","SessÃµes pontuais quando surge um desafio especÃ­fico","Nunca busquei; aprendo sozinho(a) e com a equipe","Mentoria estruturada + acompanhamento com plano de aÃ§Ã£o"],
    w:[4,2,1,3]
  },
  { q:"Seu negÃ³cio tem uma rotina organizada (processos definidos, controles de estoque, fluxo de caixa)?",
    a:["Processos bÃ¡sicos e alguns checklists em uso","Processos padronizados, indicadores e auditorias internas","Rotina definida, controles em planilhas/ERP simples","Processos mapeados e revisados com melhoria contÃ­nua"],
    w:[1,4,2,3]
  },
  { q:"VocÃª jÃ¡ possui colaboradores ou parceiros fixos na operaÃ§Ã£o?",
    a:["AutÃ´nomos/terceiros de confianÃ§a para demandas recorrentes","Equipe pequena com papÃ©is definidos e ritos semanais","Equipe estabelecida com lÃ­deres e metas por Ã¡rea","Toco praticamente tudo sozinho(a) no dia a dia"],
    w:[2,3,4,1]
  },
  { q:"Sua equipe ou fornecedores sabem exatamente seus papÃ©is no negÃ³cio?",
    a:["PapÃ©is definidos por escrito e metas por funÃ§Ã£o","PapÃ©is informais; alinhamos no dia a dia","Estrutura com organograma, SLAs e indicadores de desempenho","Ainda nÃ£o formalizamos; cada um ajuda onde dÃ¡"],
    w:[3,2,4,1]
  },
  { q:"VocÃª revisa com frequÃªncia os resultados financeiros e ajusta estratÃ©gias?",
    a:["Acompanho mensalmente e faÃ§o ajustes bÃ¡sicos","RevisÃ£o semanal com KPIs e plano de aÃ§Ã£o por alavancas","RevisÃ£o trimestral e ajustes quando necessÃ¡rio","Quase nÃ£o reviso; foco na operaÃ§Ã£o do dia a dia"],
    w:[2,4,3,1]
  },
  { q:"Sua empresa investe em inovaÃ§Ã£o ou melhorias contÃ­nuas (novos produtos, tecnologias, treinamentos)?",
    a:["Raramente; quando sobra tempo/orÃ§amento","Alguns testes e cursos pontuais por trimestre","Roadmap de melhorias com metas e responsÃ¡veis","Pipeline de inovaÃ§Ã£o com experimentos e mÃ©tricas de sucesso"],
    w:[1,2,3,4]
  },
  { q:"VocÃª tem uma estratÃ©gia de marketing clara para atrair clientes?",
    a:["Plano multicanal com mÃ©tricas de CAC/LTV e automaÃ§Ãµes","Dependemos de indicaÃ§Ã£o e redes sociais esporÃ¡dicas","CalendÃ¡rio de conteÃºdo + campanhas pontuais","AÃ§Ãµes de base (Google/Instagram) com acompanhamento simples"],
    w:[4,1,3,2]
  },
  { q:"JÃ¡ conquistou uma base de clientes recorrentes e satisfeitos?",
    a:["Base fiel com programas de retenÃ§Ã£o e NPS alto","Alguns clientes voltam; melhoramos a experiÃªncia aos poucos","Temos recorrÃªncia em linhas especÃ­ficas","Ainda Ã© instÃ¡vel; varia mÃªs a mÃªs"],
    w:[1,3,4,2]
  },
  { q:"Quando surge um problema, vocÃª tende a apagar incÃªndios ou jÃ¡ tem um plano de contingÃªncia?",
    a:["Resolvemos rÃ¡pido, mas sem padronizaÃ§Ã£o","Muitas vezes viramos a noite apagando incÃªndios","Planos de contingÃªncia documentados e treinados","Playbook de incidentes com responsÃ¡veis e comunicaÃ§Ã£o clara"],
    w:[2,1,3,4]
  },
  { q:"VocÃª dedica parte do seu tempo a pensar em expansÃ£o ou novos mercados?",
    a:["Exploramos oportunidades com metas e pesquisas formais","Plano de expansÃ£o com cronograma e budget","Penso nisso quando sobra tempo","Estudo ideias e faÃ§o testes menores para validar"],
    w:[3,4,1,2]
  },
  { q:"Se vocÃª se ausentar por alguns dias, o negÃ³cio continua funcionando sem parar?",
    a:["Sim, por semanas: processos e lÃ­deres tocam a operaÃ§Ã£o","Sim, por alguns dias com pequenas dependÃªncias","Parcialmente; preciso estar por perto para decidir pontos-chave","Ainda nÃ£o; a operaÃ§Ã£o depende muito de mim"],
    w:[4,2,3,1]
  }
];

/* ===== Resultados ===== */
const RESULTS={
  1:{title:"NÃ­vel 1 â€“ Aventureiro ðŸš€",
     desc:"ParabÃ©ns pela coragem de dar o primeiro passo! VocÃª, assim como eu, jÃ¡ saiu da ideia e partiu para a aÃ§Ã£o. Agora Ã© hora de transformar entusiasmo em estratÃ©gia para construir uma base sÃ³lida e sustentÃ¡vel para o seu negÃ³cio.",
     actions:["Buscar apoio contÃ¡bil e financeiro bÃ¡sico.","Fazer um curso introdutÃ³rio de gestÃ£o.","Criar um plano de negÃ³cios simples.","Separar finanÃ§as pessoais das empresariais."],
     avatarF:"images/nivel1-fem.png", avatarM:"images/nivel1-masc.png", course:"Ative o LaboratÃ³rio 2.0"},
  2:{title:"NÃ­vel 2 â€“ Estrategista ðŸ“Š",
     desc:"VocÃª jÃ¡ pensa e age como um verdadeiro estrategista! Seu negÃ³cio demonstra organizaÃ§Ã£o e visÃ£o de crescimento. Agora Ã© hora de fortalecer sua estratÃ©gia e desenvolver lideranÃ§a para conquistar novos mercados.",
     actions:["Participar de mentorias com empresÃ¡rios experientes.","Investir em marketing estruturado e automaÃ§Ã£o.","Acompanhar indicadores financeiros regularmente.","Desenvolver habilidades de lideranÃ§a."],
     avatarF:"images/nivel2-fem.png", avatarM:"images/nivel2-masc.png", course:"Ative o LaboratÃ³rio 3.0"},
  3:{title:"NÃ­vel 3 â€“ LÃ­der ðŸ†",
     desc:"VocÃª alcanÃ§ou a posiÃ§Ã£o de lÃ­der! Sua visÃ£o inspira sua equipe e o mercado. Agora o desafio Ã© inovar, expandir e preparar sucessores para perpetuar o legado da sua empresa.",
     actions:["Investir em inovaÃ§Ã£o e tecnologia.","Expandir para novos mercados.","Formar e capacitar lÃ­deres internos.","Criar planos de sucessÃ£o e governanÃ§a corporativa."],
     avatarF:"images/nivel3-fem.png", avatarM:"images/nivel3-masc.png", course:"Ative o LaboratÃ³rio 4.0"}
};

/* ===== Estado e navegaÃ§Ã£o ===== */
let state={idx:0,score:0,gender:"masc"};
function go(id){ document.querySelectorAll('.screen').forEach(s=>s.classList.remove('show')); document.getElementById(id).classList.add('show'); }
let start = gateOr(function(g){ state.gender=g;state.idx=0;state.score=0; renderQ(); go('quiz'); });

/* ===== RenderizaÃ§Ã£o do quiz ===== */
function renderQ(){
  if(state.idx>=QUESTIONS.length){finish();return;}
  let fundo="images/fundo1.png";
  if(state.idx>=5 && state.idx<10) fundo="images/fundo2.png";
  if(state.idx>=10) fundo="images/fundo3.png";
  document.getElementById('bg-quiz').style.backgroundImage="url('"+fundo+"')";
  document.getElementById('q-counter').textContent=(state.idx+1)+"/"+QUESTIONS.length;
  document.getElementById('quiz-head').style.display=(state.idx===0)?'block':'none';
  const q=QUESTIONS[state.idx];
  document.getElementById('qtext').textContent=q.q;
  const opts=document.getElementById('opts'); opts.innerHTML="";
  q.a.forEach((t,i)=>{
    const b=document.createElement('button');
    b.className='opt'; b.textContent=t;
    b.onclick=()=>{ playClick(); state.score += (q.w ? q.w[i] : (i+1)); state.idx++; renderQ(); };
    opts.appendChild(b);
  });
}

/* ===== Final ===== */
function finish(){
  let lvl = 1;
  if(state.score > 45) lvl = 3;
  else if(state.score > 27) lvl = 2;
  const res=RESULTS[lvl];
  document.getElementById('r-title').textContent=res.title;
  document.getElementById('r-desc').textContent=res.desc;
  const ul=document.getElementById('r-actions'); ul.innerHTML="";
  res.actions.forEach(a=>{const li=document.createElement('li'); li.textContent="ðŸ”¹ "+a; ul.appendChild(li);});
  const rc=document.getElementById('r-course'); rc.textContent=res.course;
  rc.onclick = ()=>{ window.open('https://bit.ly/eva_acontabil', '_blank'); };
  document.getElementById('bg-result').style.backgroundImage="url('"+(state.gender==='fem'?res.avatarF:res.avatarM)+"')";
  playWin(); go('result');
}

/* ===== InicializaÃ§Ã£o ===== */
document.addEventListener('DOMContentLoaded', validarAcessoSeHouverToken);
</script>

</body>
</html>
